#!/bin/bash

echo "üîç Apple Sign-In Capability Verification"
echo "========================================"
echo ""

BUNDLE_ID="com.ablankcanvas.financemate"
TEAM_ID="7KV34995HH"

echo "üìã Configuration Status:"
echo "   Bundle ID: $BUNDLE_ID ‚úÖ (Already exists)"
echo "   Team ID: $TEAM_ID ‚úÖ (Valid)"
echo ""

echo "üö® LIKELY ISSUE: Sign In with Apple capability not enabled"
echo ""
echo "Since the Bundle ID already exists, the issue is most likely that"
echo "the 'Sign In with Apple' capability is not enabled for this App ID."
echo ""

echo "üîß SPECIFIC FIX REQUIRED:"
echo ""
echo "1. Go to: https://developer.apple.com/account/"
echo "2. Navigate to: Certificates, Identifiers & Profiles ‚Üí Identifiers"
echo "3. Find and click: 'com.ablankcanvas.financemate'"
echo ""
echo "4. CHECK CAPABILITIES SECTION:"
echo "   Look for 'Sign In with Apple' in the capabilities list"
echo ""
echo "   ‚ùå If NOT enabled:"
echo "   ‚Ä¢ Check the 'Sign In with Apple' checkbox"
echo "   ‚Ä¢ Select 'Enable as Primary App ID'"
echo "   ‚Ä¢ Click 'Save' at the top right"
echo ""
echo "   ‚úÖ If already enabled:"
echo "   ‚Ä¢ The issue may be provisioning profile"
echo "   ‚Ä¢ Continue to step 5"
echo ""

echo "5. UPDATE PROVISIONING PROFILE:"
echo "   - Navigate to: Profiles"
echo "   - Look for profile containing '$BUNDLE_ID'"
echo "   - If found: Click 'Edit' ‚Üí Regenerate ‚Üí Download"
echo "   - If not found: Create new macOS Development profile"
echo "     ‚Ä¢ Name: FinanceMate Development"
echo "     ‚Ä¢ Type: macOS App Development"
echo "     ‚Ä¢ App ID: com.ablankcanvas.financemate"
echo "     ‚Ä¢ Certificates: Select your certificate"
echo "     ‚Ä¢ Devices: Select your Mac"
echo "     ‚Ä¢ Generate ‚Üí Download"
echo ""

echo "6. INSTALL PROVISIONING PROFILE:"
echo "   - Double-click the downloaded .provisionprofile file"
echo "   - OR: Open Xcode ‚Üí Preferences ‚Üí Accounts ‚Üí Download Manual Profiles"
echo ""

echo "7. VERIFY IN XCODE:"
echo "   - Open FinanceMate.xcodeproj"
echo "   - Select FinanceMate target"
echo "   - Go to 'Signing & Capabilities' tab"
echo "   - Verify:"
echo "     ‚Ä¢ Team: BERNHARD JOSHUA BUDIONO (7KV34995HH)"
echo "     ‚Ä¢ Bundle Identifier: com.ablankcanvas.financemate"
echo "     ‚Ä¢ Provisioning Profile: Automatic (or select manual profile)"
echo "     ‚Ä¢ Capabilities: 'Sign In with Apple' should be listed"
echo ""

echo "üß™ TESTING STEPS:"
echo ""
echo "After configuration:"
echo "1. Clean Build (‚åò+Shift+K)"
echo "2. Build and Run"
echo "3. Test Apple Sign-In ‚Üí Should work without error"
echo "4. Test Google Sign-In ‚Üí Should continue working"
echo ""

echo "‚ö° QUICK VERIFICATION:"
echo ""
echo "To verify the capability is enabled, check in Apple Developer Portal:"
echo "‚Ä¢ Go to Identifiers ‚Üí com.ablankcanvas.financemate"
echo "‚Ä¢ Scroll down to 'Capabilities' section"
echo "‚Ä¢ Look for 'Sign In with Apple' with blue checkmark"
echo ""
echo "If you see 'Sign In with Apple ‚úÖ Enabled', then the issue is"
echo "likely the provisioning profile needs to be regenerated."
echo ""

echo "üéØ SUCCESS INDICATORS:"
echo "‚Ä¢ No error message when tapping Apple Sign-In"
echo "‚Ä¢ Apple authentication flow appears normally"
echo "‚Ä¢ Both authentication methods work seamlessly"
echo ""

echo "üìû If this doesn't resolve the issue:"
echo "‚Ä¢ Check that Apple Developer Program membership is active"
echo "‚Ä¢ Verify you have admin access to Team ID 7KV34995HH"
echo "‚Ä¢ Wait 10-15 minutes after making changes before testing"